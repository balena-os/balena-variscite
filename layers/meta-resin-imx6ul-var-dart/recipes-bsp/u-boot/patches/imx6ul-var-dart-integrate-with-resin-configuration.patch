From 83868c4bba5cd19f14de383c4d8d16e30a2cc170 Mon Sep 17 00:00:00 2001
From: Florin Sarbu <florin@resin.io>
Date: Fri, 15 Jun 2018 08:51:15 +0200
Subject: [PATCH] imx6ul-var-dart machine specific integration of resin
 environment configuration.

Upstream-Status: Inappropriate [configuration]

Signed-off-by: Florin Sarbu <florin@resin.io>
---
 include/configs/mx6ul_var_dart.h | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/include/configs/mx6ul_var_dart.h b/include/configs/mx6ul_var_dart.h
index 0839185..2a979d5 100644
--- a/include/configs/mx6ul_var_dart.h
+++ b/include/configs/mx6ul_var_dart.h
@@ -15,6 +15,10 @@
 /* DCDC used on DART-6UL, no PMIC */
 #undef CONFIG_LDO_BYPASS_CHECK
 
+/* We need the part command */
+#define CONFIG_PARTITION_UUIDS
+#define CONFIG_CMD_PART
+
 #ifdef CONFIG_SPL
 #include "imx6_spl.h"
 #endif
@@ -78,7 +82,7 @@
 	"mmcbootpart=1\0" \
 	"mmcrootpart=2\0" \
 	"mmcargs=setenv bootargs console=${console},${baudrate} " \
-		"root=/dev/mmcblk${mmcblk}p${mmcrootpart} rootwait rw " \
+		"${resin_kernel_root} rootwait rw " \
 		"${cma_size}\0" \
 	"loadbootenv=" \
 		"load mmc ${mmcdev}:${mmcbootpart} ${loadaddr} ${bootdir}/${bootenv}\0" \
@@ -113,6 +117,10 @@
 #ifdef CONFIG_NAND_BOOT
 #define BOOT_ENV_SETTINGS	NAND_BOOT_ENV_SETTINGS
 #define CONFIG_BOOTCOMMAND \
+	"setenv resin_kernel_load_addr ${loadaddr};" \
+	"run resin_set_kernel_root;" \
+	"setenv mmcdev ${resin_dev_index};" \
+	"setenv mmcbootpart ${resin_boot_part};" \
 	"run ramsize_check; " \
 	"run nandboot || " \
 	"run netboot"
-- 
2.7.4

